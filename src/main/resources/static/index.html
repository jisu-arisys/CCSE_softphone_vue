<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="robots" content="noindex">
    <title>Dashboard - Zoomly</title>
    <meta name="description" content="Zoom Phone Smart Embed">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/img_logo.png">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&display=swap">

    <style>
        [v-cloak] {
            display: none;
        }

        #wrapper {
            display: flex;
            min-height: 100vh;
        }

        #content-wrapper {
            flex: 1;
            min-width: 0;
        }

        #zoom-embeddable-phone-iframe-right-side {
            flex-shrink: 0;
            height: 100vh;
        }

        .iframe-collapsed #zoom-embeddable-phone-iframe-right-side {
            width: 0px !important; /* Collapse the iframe */
            flex-shrink: 0; /* Prevent it from taking space */
            overflow: hidden; /* Hide content when collapsed */
            border: none; /* Hide border if any */
            padding: 0; /* Hide padding if any */
            margin: 0; /* Hide margin if any */
        }

        #iframe-resize-handle {
            width: 10px; /* Width of the draggable area */
            cursor: col-resize; /* Indicates it's resizable */
            background-color: transparent; /* Default to transparent */
            border: none; /* Ensure no border */
            padding: 0; /* Ensure no padding */
            position: relative;
            display: flex; /* To help center the icon */
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            height: 100vh; /* Match iframe height */
            z-index: 10; /* Ensure it's clickable */
            transition: background-color 0.2s ease-in-out; /* Smooth transition for hover */
        }

        /* Only apply hover effect if the wrapper is NOT collapsed */
        #wrapper:not(.iframe-collapsed) #iframe-resize-handle:hover {
            background-color: #cccccc;
        }

        /* Styles for collapsed state */
        #wrapper.iframe-collapsed #iframe-resize-handle { /* Increased specificity */
            width: 40px !important; /* Width of the bar when collapsed */
            background-color: #007bff !important; /* Blue background */
            cursor: pointer !important; /* Indicate clickable to expand */
            /* Ensure other properties don't interfere */
            min-width: 40px !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            visibility: visible !important;
            opacity: 1 !important;
            display: flex !important; /* Keep it as a flex container for the icon */
            align-items: center;
            justify-content: center;
            transition: none !important;
            z-index: 1000; /* Ensure it's on top */
        }
        /* Remove hover effect for the handle itself when collapsed */
        #wrapper.iframe-collapsed #iframe-resize-handle:hover { /* Increased specificity */
            background-color: #0056b3 !important; /* Darker blue on hover for feedback */
        }


        #content-wrapper {
            transition: margin-right 0.3s ease-in-out; /* Smooth transition for content area */
        }
        /* No specific margin change needed for #content-wrapper if iframe width goes to 0 and it's a flex item */

        /* Styles for hover placement */
        #floating-iframe-container {
            position: fixed;
            top: 100px; /* Default top position for floating iframe */
            right: 20px; /* Default right position for floating iframe */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid #ccc; /* A subtle border for the container */
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000; /* Ensure it's above other content */
            display: flex;
            flex-direction: column;
            resize: both; /* Allow manual resizing */
            min-width: 200px;
            min-height: 200px;
            transition: opacity 0.3s ease-in-out;
            background-color: white; /* Ensure solid background to prevent transparency */
            backdrop-filter: none; /* Prevent any backdrop blur effects */
            -webkit-backdrop-filter: none; /* Safari support */
        }

        #floating-iframe-container.floating-hidden {
            opacity: 0;
            pointer-events: none; /* Disable interactions when hidden */
        }

        #floating-iframe-header {
            background-color: #f8f9fa; /* Light background for the header */
            padding: 5px 10px;
            cursor: grab; /* Indicate draggable */
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
            color: #666;
        }

        #floating-iframe-header .title {
            font-weight: bold;
        }

        #floating-iframe-header .close-btn {
            cursor: pointer;
            font-size: 1.2em;
            color: #888;
        }

        #floating-iframe-header .close-btn:hover {
            color: #333;
        }

        #zoom-embeddable-phone-iframe-hover {
            flex-grow: 1; /* Allow iframe to take remaining space in column */
            border: none; /* Remove iframe's own border */
            width: 100%; /* Take full width of its container */
            height: 100%; /* Take full height of its container */
            background-color: white; /* Ensure iframe has solid background */
        }

        /* Styles for navbar integrated info box (both modes) */
        #navbar-info-box {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 10px 14px;
            font-size: 0.85rem;
            display: flex;
            align-items: stretch;
            gap: 20px;
            white-space: nowrap;
            min-height: 50px;
        }

        #navbar-info-box .navbar-info-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            min-width: 0;
        }

        /* Agent State section - fixed width for label + dropdown */
        #navbar-info-box .navbar-info-item:first-child {
            flex: 0 0 180px;
            min-width: 180px;
        }
        /* Slightly narrower when engagement count is hidden */
        #navbar-info-box:not(.navbar-wide) .navbar-info-item:first-child {
            flex: 0 0 150px;
            min-width: 150px;
        }

        /* Combined Engagements section - width for label + counts + toggle */
        #navbar-info-box .navbar-info-item.engagements-item {
            flex: 0 0 250px;
            min-width: 250px;
        }

        #navbar-info-box .navbar-info-label {
            font-size: 0.7rem;
            color: #6c757d;
            margin-bottom: 3px;
            font-weight: 500;
            line-height: 1;
            text-transform: none;
            letter-spacing: 0.2px;
        }

        #navbar-info-box .navbar-info-value {
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            line-height: 1.2;
            width: 100%;
        }

        #navbar-info-box .navbar-toggle-btn {
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #navbar-info-box .navbar-toggle-btn:hover {
            background-color: #f8f9fa;
        }

        #navbar-info-box .navbar-divider {
            width: 1px;
            height: 40px;
            background-color: #dee2e6;
            align-self: center;
        }

        #navbar-info-box .navbar-status-select {
            font-size: 0.75rem;
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 3px;
            background-color: white;
            min-width: 90px;
            max-width: 130px;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        #navbar-info-box .navbar-status-select:focus {
            border-color: #86b7fe;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }



        /* Improve dropdown appearance */
        #navbar-info-box .navbar-status-select option {
            padding: 4px 8px;
        }



        /* Make the navbar info box wider when engagement actions are present */
        #navbar-info-box.navbar-wide {
            min-width: 600px;
        }

        /* Engagement Drawer Styles */
        .engagement-drawer {
            position: absolute;
            top: 100%;
            right: 0;
            width: 100%;
            max-height: 0;
            overflow: hidden;
            background: white;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: max-height 0.3s ease;
            z-index: 1000;
        }

        /* Ensure the navbar-info-box has relative positioning for the drawer */
        #navbar-info-box {
            position: relative;
        }

        .engagement-drawer-open {
            max-height: 400px;
        }

        .engagement-drawer-body {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .engagement-drawer .table {
            font-size: 0.8rem;
        }

        .engagement-drawer .table th {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6c757d;
            border-top: none;
            padding: 8px 12px;
        }

        .engagement-drawer .table td {
            padding: 8px 12px;
            vertical-align: middle;
        }

        .engagement-drawer .badge {
            font-size: 0.7rem;
            padding: 4px 8px;
        }

        .engagement-drawer .btn {
            padding: 2px 6px;
            font-size: 0.7rem;
        }

        .engagement-drawer .form-control {
            font-size: 0.7rem;
            padding: 4px 8px;
        }

    </style>
</head>

<body id="page-top">
<div id="wrapper" v-cloak :class="{'iframe-collapsed': isIframeCollapsed}">
    <div class="modal fade" id="editContactModal" tabindex="-1" aria-labelledby="editContactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editContactModalLabel">Edit Contact</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="editName" v-model="editingContact.name">
                        </div>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editEmail" v-model="editingContact.email">
                        </div>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editEmail" class="form-label">User ID</label>
                            <input type="email" class="form-control" id="editUserId" v-model="editingContact.id">
                        </div>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editAccount" class="form-label">Account</label>
                            <input type="text" class="form-control" id="editAccount" v-model="editingContact.account">
                        </div>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="editLocation" v-model="editingContact.location">
                        </div>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editOrders" class="form-label">Orders</label>
                            <input type="text" class="form-control" id="editOrders" v-model="editingContact.orders">
                        </div>
                        <div class="mb-3" v-if="editingContact">
                            <label for="editPhone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="editPhone" v-model="editingContact.phone">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" @click="saveContact">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0"
         :style="'background: ' + leftSideNavColor">
        <div class="container-fluid d-flex flex-column p-0"><a
                class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
            <div class="sidebar-brand-text mx-3"><img :src="leftSideNavLogo" width="160"></div>
        </a>
            <ul class="navbar-nav text-light" id="accordionSidebar">
                <li class="nav-item"><a class="nav-link" @click.prevent="pageView='dashboard'"><i
                        class="fas fa-tachometer-alt"></i><span style="font-family: Lato, sans-serif;">
                                Dashboard</span></a></li>
                <li class="nav-item"><a class="nav-link" @click.prevent="pageView='accounts'"><i
                        class="fas fa-table"></i><span
                        style="font-family: Lato, sans-serif;">Accounts</span></a></li>
                <li class="nav-item"><a class="nav-link" @click.prevent="pageView='logs'"><i
                        class="fas fa-phone"></i><span style="font-family: Lato, sans-serif;">Call
                                Log</span></a></li>
                <li class="nav-item"><a class="nav-link" @click.prevent="pageView='settings'"><i
                        class="fas fa-cog"></i><span style="font-family: Lato, sans-serif;">Settings</span></a>
                </li>
                <li v-if="zccSmartHelp" class="nav-item"><a class="nav-link"
                                                            @click.prevent="pageView='instructions'"><i class="fas fa-log"></i><span
                        style="font-family: Lato, sans-serif;">Help</span></a>
                </li>
                <li v-if="debug" class="nav-item"><a class="nav-link"
                                                     @click.prevent="pageView='debug'"><i class="fas fa-log"></i><span
                        style="font-family: Lato, sans-serif;">Debug</span></a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="d-flex flex-column" id="content-wrapper">
        <div id="content">
            <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                <div class="container-fluid flex-nowrap">
                    <form class="d-sm-inline-block w-auto me-auto">
                        <div class="input-group"><input class="bg-light form-control border-0 small" type="text"
                                                        id="phoneNumber" v-model="numberToCall" name="phoneNumber" inputmode="tel" placeholder="e.g., (650) 555-7890">
                            <button class="btn btn-primary py-0" type="button" @click.prevent="makeCall();">Call</button>
                        </div>
                    </form>
                    <ul class="navbar-nav flex-nowrap ms-auto align-items-center">
                        <!-- Unified info box for both right-side and hover modes -->
                        <li class="nav-item ms-3" v-if="effectiveShowAgentStatus || showEngagementCount || placement === 'hover'">
                            <div id="navbar-info-box" :class="{ 'navbar-wide': showEngagementCount }">
                                <div v-if="effectiveShowAgentStatus" class="navbar-info-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="navbar-info-label mb-0">Agent State</div>
                                        <div v-if="effectiveAllowUserToChangeStatus" class="navbar-info-value">
                                            <select :class="['form-select', 'form-select-sm', 'navbar-status-select', statusDropdownClass]"
                                                    v-model="selectedStatus"
                                                    @change="setAgentStatus(selectedStatus)"
                                                    :disabled="!canChangeStatus">
                                                <option v-for="status in availableStatuses"
                                                        :key="status.id"
                                                        :value="status.id"
                                                        :disabled="status.disabled">
                                                    {{ status.name }}
                                                </option>
                                            </select>
                                        </div>
                                        <div v-else class="navbar-info-value" :class="statusDropdownClass">
                                            <span v-if="agentSubReason">{{ agentSubReason }}</span>
                                            <span v-else>{{ agentStatusDisplay }}</span>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="effectiveShowAgentStatus && showEngagementCount" class="navbar-divider"></div>

                                <div v-if="showEngagementCount" class="navbar-info-item engagements-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="navbar-info-label mb-0">Engagements</div>
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="text-primary fw-bold">{{ engagementCount.active }}</span>
                                            <small class="text-muted">active</small>
                                            <span class="text-muted">|</span>
                                            <span class="text-primary fw-bold">{{ engagementCount.wrapup }}</span>
                                            <small class="text-muted">wrap-up</small>
                                            <div class="ms-2">
                                                <button class="btn btn-sm btn-outline-primary"
                                                        @click="toggleEngagementDrawer()"
                                                        title="Toggle Engagement Details">
                                                    <i class="bi" :class="isEngagementDrawerOpen ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Engagement Drawer -->
                                    <div class="engagement-drawer"
                                         :class="{ 'engagement-drawer-open': isEngagementDrawerOpen }">
                                        <div class="engagement-drawer-body">
                                            <div v-if="Object.keys(allActiveEngagements).length > 0" class="table-responsive">
                                                <table class="table table-sm table-hover mb-0">
                                                    <thead>
                                                    <tr>
                                                        <th>Channel</th>
                                                        <th>State</th>
                                                        <th>Customer</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr v-for="(engagement, id) in allActiveEngagements" :key="id">
                                                        <td>
                                                                    <span class="badge" :class="getChannelBadgeClass(engagement.channel)">
                                                                        {{ engagement.channel }}
                                                                    </span>
                                                        </td>
                                                        <td>
                                                                    <span class="badge" :class="getStateBadgeClass(engagement.state)">
                                                                        {{ engagement.state === 'active' && engagement.channel === 'voice' && !engagement.callConnected ? 'Incoming' : engagement.state }}
                                                                    </span>
                                                        </td>
                                                        <td>
                                                            <small class="text-muted">
                                                                <span v-if="engagement.customerName">{{ engagement.customerName }}</span>
                                                                <span v-else>N/A</span>
                                                            </small>
                                                        </td>
                                                        <td>
                                                            <div class="d-flex gap-1">
                                                                <!-- Show terminate button for all active and connected engagements -->
                                                                <button v-if="engagement.state === 'active' && engagement.callConnected"
                                                                        class="btn btn-sm btn-danger"
                                                                        @click="terminateEngagement(id, engagement.channel)"
                                                                        :title="'End ' + engagement.channel.charAt(0).toUpperCase() + engagement.channel.slice(1)">
                                                                    <i class="bi bi-x-circle">&nbsp;End</i>
                                                                </button>

                                                                <div v-if="engagement.state === 'wrapup'" class="d-flex gap-2 align-items-center">
                                                                    <select v-if="dispositionMappings.length > 0"
                                                                            class="form-select form-select-sm"
                                                                            v-model="engagement.dispositionId"
                                                                            @change="setEngagementDisposition(id, engagement.channel, engagement.dispositionId)"
                                                                            style="width: 200px;">
                                                                        <option value="">Select Disposition</option>
                                                                        <option v-for="mapping in dispositionMappings"
                                                                                :key="mapping.id"
                                                                                :value="mapping.id">
                                                                            {{ mapping.name }}
                                                                        </option>
                                                                    </select>
                                                                    <input v-else
                                                                           type="text"
                                                                           class="form-control form-control-sm"
                                                                           placeholder="Disposition ID"
                                                                           v-model="engagement.dispositionId"
                                                                           @change="setEngagementDisposition(id, engagement.channel, engagement.dispositionId)"
                                                                           style="width: 200px;">
                                                                    <button class="btn btn-sm btn-primary"
                                                                            @click="closeEngagementWrapup(id, engagement.channel)"
                                                                            title="Close">
                                                                        <i class="bi bi-check-circle">&nbsp;Close</i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div v-else class="text-center text-muted py-3">
                                                <i class="bi bi-inbox" style="font-size: 1.5rem;"></i>
                                                <p class="mb-0 mt-2">No current engagements</p>
                                                <small>Engagements will appear here when calls, chats, SMS, or other channels are active or in wrap-up.</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <div v-if="(effectiveShowAgentStatus || showEngagementCount) && placement === 'hover'" class="navbar-divider"></div>

                                <div v-if="placement === 'hover'" class="navbar-info-item">
                                    <div class="navbar-toggle-btn" @click.prevent="toggleFloatingIframeVisibility" title="Toggle Smart Embed Window">
                                        <i class="bi bi-headset" style="font-size: 1.2rem;"></i>
                                    </div>
                                </div>
                            </div>
                        </li>

                    </ul>
                </div>
            </nav>

            <div id="dashboard" v-if="pageView=='dashboard'" class="container-fluid">
                <div class="d-sm-flex justify-content-between align-items-center mb-4">
                    <h3 class="text-dark mb-0">Dashboard</h3>
                </div>
                <div class="row">
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow mb-4 h-100">
                            <div class="card-header py-3">
                                <h6 class="text-primary fw-bold m-0">Todo List</h6>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <h6 class="mb-0"><strong>Team Meeting</strong></h6><span
                                                class="text-xs">10:30 AM</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check"><input class="form-check-input" type="checkbox"
                                                                           id="formCheck-1"><label class="form-check-label"
                                                                                                   for="formCheck-1"></label></div>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <h6 class="mb-0"><strong>HR Annual Training</strong></h6><span
                                                class="text-xs">3:30 PM</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check"><input class="form-check-input" type="checkbox"
                                                                           id="formCheck-3"><label class="form-check-label"
                                                                                                   for="formCheck-3"></label></div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow mb-4 h-100">
                            <div class="card-header py-3">
                                <h6 class="text-primary fw-bold m-0">Tickets</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="text-center border-end">
                                            <div class="text-uppercase text-primary fw-bold text-xs mb-2">My Tickets</div>
                                            <div class="text-dark fw-bold h4 mb-1">16</div>
                                            <i class="fas fa-calendar fa-lg text-gray-300"></i>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center">
                                            <div class="text-uppercase text-success fw-bold text-xs mb-2">Team Tickets</div>
                                            <div class="text-dark fw-bold h4 mb-1">348</div>
                                            <i class="fas fa-users fa-lg text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow mb-4 h-100">
                            <div class="card-header py-3">
                                <h6 class="text-primary fw-bold m-0">Work Status</h6>
                            </div>
                            <div class="card-body">
                                <div class="row h-100">
                                    <div class="col-6 d-flex flex-column justify-content-center">
                                        <div class="text-center border-end">
                                            <div class="text-uppercase text-info fw-bold text-xs mb-2">Tasks</div>
                                            <div class="row g-0 align-items-center justify-content-center mb-2">
                                                <div class="col-auto">
                                                    <div class="text-dark fw-bold h5 mb-0 me-2">50%</div>
                                                </div>
                                                <div class="col-8">
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar bg-info" aria-valuenow="50"
                                                             aria-valuemin="0" aria-valuemax="100" style="width: 50%;">
                                                            <span class="visually-hidden">50%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <i class="fas fa-clipboard-list fa-lg text-gray-300"></i>
                                        </div>
                                    </div>
                                    <div class="col-6 d-flex flex-column justify-content-center">
                                        <div class="text-center">
                                            <div class="text-uppercase text-primary fw-bold text-xs mb-2">Today's Engagements</div>
                                            <div class="text-dark fw-bold h4 mb-1">{{ todaysInteractionsCount }}</div>
                                            <i class="fas fa-comments fa-lg text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="row">
                            <div class="col-lg-4 mb-4">
                                <div class="card shadow h-100">
                                    <div class="card-header py-3">
                                        <h6 class="text-primary fw-bold m-0">Customer Segments</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between small mb-1"><span class="text-muted">New</span><span>28%</span></div>
                                        <div class="progress progress-sm mb-2"><div class="progress-bar bg-primary" style="width: 28%;"></div></div>
                                        <div class="d-flex justify-content-between small mb-1"><span class="text-muted">Returning</span><span>54%</span></div>
                                        <div class="progress progress-sm mb-2"><div class="progress-bar bg-success" style="width: 54%;"></div></div>
                                        <div class="d-flex justify-content-between small mb-1"><span class="text-muted">Priority</span><span>18%</span></div>
                                        <div class="progress progress-sm"><div class="progress-bar bg-warning" style="width: 18%;"></div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 mb-4">
                                <div class="card shadow h-100">
                                    <div class="card-header py-3">
                                        <h6 class="text-primary fw-bold m-0">SLA</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-6 border-end">
                                                <div class="text-uppercase text-success fw-bold text-xs mb-2">On-time</div>
                                                <div class="text-dark fw-bold h4 mb-1">96%</div>
                                            </div>
                                            <div class="col-6">
                                                <div class="text-uppercase text-danger fw-bold text-xs mb-2">Breached</div>
                                                <div class="text-dark fw-bold h4 mb-1">4%</div>
                                            </div>
                                        </div>
                                        <div class="progress progress-sm mt-2">
                                            <div class="progress-bar bg-success" style="width: 96%;"></div>
                                        </div>
                                        <div class="text-xs text-muted mt-1">Service levels this month</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 mb-4">
                                <div class="card shadow h-100">
                                    <div class="card-header py-3">
                                        <h6 class="text-primary fw-bold m-0">Escalation Rate</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="text-dark fw-bold h3 mb-2">6%</div>
                                        <div class="text-xs text-muted">Of total interactions</div>
                                        <div class="progress progress-sm mt-2">
                                            <div class="progress-bar bg-danger" style="width: 6%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="text-primary fw-bold m-0">Recent Communications</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm my-0">
                                        <thead>
                                        <tr>
                                            <th>Channel</th>
                                            <th>Contact</th>
                                            <th>Queue</th>
                                            <th>Date Time</th>
                                            <th>Disposition</th>
                                            <th>Contact Name</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr v-for="call in dashboardCallLogs" :key="call.engagementId">
                                            <td>{{call.type || call.direction}}</td>
                                            <td>{{call.phoneNumber}}</td>
                                            <td>{{call.queue}}</td>
                                            <td>{{call.dateTime}}</td>
                                            <td>{{call.disposition}}</td>
                                            <td>
                                                <a v-if="call.contactName && call.contactIndex !== -1"
                                                   @click.prevent="viewContact(call.contactIndex)"
                                                   href="#" class="text-primary">
                                                    {{call.contactName}}
                                                </a>
                                                <span v-else class="text-muted">-</span>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="logs" v-if="pageView=='logs'" class="container-fluid">
                <h3 class="text-dark mb-4">Communication Logs</h3>
                <div class="card shadow">
                    <div class="card-header py-3 d-flex justify-content-between align-items-center">
                        <p class="text-primary m-0 fw-bold">Recent Communications</p>
                        <button class="btn btn-sm btn-danger" @click="clearCommunicationLogs">Clear Logs</button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                            <table class="table table-striped table-sm my-0 mydatatable">
                                <thead>
                                <tr>
                                    <th>Call Type</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Queue</th>
                                    <th>Date / Time</th>
                                    <th>Duration</th>
                                    <th>Engagement ID</th>
                                    <th>Disposition</th>
                                    <th>Notes</th>
                                    <th>Recording</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="call in recentCalls">
                                    <td>{{call ? call.type : ''}}</td>
                                    <td>{{call ? call.fromNumber : ''}}</td>
                                    <td>{{call ? call.toNumber : ''}}</td>
                                    <td>{{call ? call.queue : ''}}</td>
                                    <td>{{call ? formatCallTimestamp(call.timestamp) : ''}}</td>
                                    <td>{{call ? formatCallDuration(call.duration) : ''}}</td>
                                    <td>{{call ? call.engagementId : ''}}</td>
                                    <td>{{call ? call.dispositionCode : ''}}</td>
                                    <td>{{call ? call.notes : ''}}</td>
                                    <td><a v-if="call && call.type !='chat' && call.type !='sms' && call.engagementId && zccRecordingURLs[call.engagementId]"
                                           :href="zccRecordingURLs[call.engagementId]"
                                           target="_blank">download</a></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="logs" v-if="pageView=='instructions'" class="container-fluid">
                <h3 class="text-dark mb-4">ZCC Smart Embed Instructions</h3>
                <p>This is a demo page for ZCC Smart Embed testing.</p>
                <hr>
                <h4>Important Notes:</h4>

                The website developer is responsible for adding Smart Embed into their site. For this demo site, we feature a number of events that the Zoomlly Hues demo site is listening to, and which are added to this demo site. This includes the top part "agent state" and the "Engagement count". These are optional settings, but the website developer of the webpage where Smart Embed is added must add this capability to their site. It requires Javascript coding on the website.
                <hr>
                <h4>Supported Channels</h4>
                <ul>
                    <li>Voice</li>
                    <li>Web Chat</li>
                    <li>Video</li>
                    <li>SMS (V3 only)</li>
                </ul>
                <hr>
                <h4>Setup</h4>
                <span>Please see the configuration options in the <i>Settings</i> page on the left side nav bar.</span>
                <hr>
                <h4>Known Issues:</h4>
                <ul>
                    <li>WebRTC Seperate Window mode does not work right with some of the Smart Embed events. Do not use this mode for demos.</li>
                    <li>Sometimes it seems that timestamps are in inconsistent format, if you see this, please
                        screenshot and send to Justin.</li>
                    <li>The zcc-get-variables event is not working in Smart Embed V3. This prevents the 'custom card' from working. Please see ZOOM-994459</li>
                </ul>
                <hr>
                Please contact Justin Steinberg with any questions.

            </div>


            <div id="accounts" v-if="pageView=='accounts'" class="container-fluid">
                <h3 class="text-dark mb-4">Accounts</h3>
                <div class="card shadow">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Active Account Info</p>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                            <table class="table my-0" id="accountsTable">
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <td>Email</td>
                                    <th>Account</th>
                                    <th>Location</th>
                                    <th>Orders</th>
                                    <th>Contact</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="(contact, index) in contacts">
                                    <td style="font-family: Lato, sans-serif;"><img class="rounded-circle me-2"
                                                                                    width="30" height="30" :src="'/img/contact-' + index + '.png'">
                                        <a href="#" @click.prevent="viewContact(index)">{{contact && contact.name ? contact.name : ''}}</a>
                                    </td>
                                    <td>{{contact && contact.email ? contact.email : ''}}</td>
                                    <td>{{contact && contact.account ? contact.account : ''}}</td>
                                    <td>{{contact && contact.location ? contact.location : ''}}</td>
                                    <td>{{contact && contact.orders ? contact.orders : ''}}</td>
                                    <td><a @click.prevent="makeCall(contact && contact.phone ? contact.phone : '')"
                                           href="#">{{contact && contact.phone ? contact.phone : ''}}</a>
                                    </td>
                                    <td>
                                        <button class="btn btn-primary btn-sm" @click="editContact(index)">Edit</button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="contactdetails" v-if="pageView=='contactdetails' && selectedContact !== null" class="container-fluid">
                <h3 class="text-dark mb-4">{{selectedContact ? contacts[selectedContact].name : ''}}
                    <button type="button" class="btn-close" aria-label="Close"
                            @click.prevent="clearSelectedContact()"></button>
                </h3>
                <div class="card shadow">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Contact Details</p>
                    </div>
                    <div class="card-body">
                        <table>
                            <tr>
                                <td>
                                    <img class="rounded-circle me-2" width="100" height="100"
                                         :src="'/img/contact-' + selectedContact + '.png'">
                                </td>
                                <td>
                                    <b>Email: </b>{{selectedContact !== null ? contacts[selectedContact].email : ''}}<br>
                                    <b>Phone: </b><a @click.prevent="makeCall(selectedContact !== null ? contacts[selectedContact].phone : '')"
                                                     href="#">{{selectedContact !== null ? contacts[selectedContact].phone : ''}}</a><br>
                                    <b>Account: </b> {{selectedContact !== null ? contacts[selectedContact].account : ''}}<br>
                                    <b>Location: </b> {{selectedContact !== null ? contacts[selectedContact].location : ''}}<br>
                                    <b>Orders: </b> {{selectedContact !== null ? contacts[selectedContact].orders : ''}}<br>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div v-if="shouldDisplayCustomCard" class="card shadow mt-4">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <p class="text-primary m-0 fw-bold">{{ customCard.title }}</p>
                        </div>
                        <div class="card-body">
                            <table>
                                <tbody>
                                <tr v-for="field in customCard.fields">
                                    <td><b>{{ field.displayName }}: </b>{{ field.value }}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="card shadow mt-4">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Current Engagements</p>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                            <table class="table table-striped table-sm my-0">
                                <thead>
                                <tr>
                                    <th>Engagement ID</th>
                                    <th>Channel</th>
                                    <th>Direction</th>
                                    <th>State</th>
                                    <th>Note</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="(engagement, id) in activeEngagementsForContact" :key="id">
                                    <td>{{ id }}</td>
                                    <td>{{ engagement.channel }}</td>
                                    <td>{{ engagement.engagementDirection }}</td>
                                    <td>{{ engagement.state }}</td>
                                    <td>-</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="card shadow mt-4">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Communication Logs</p>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                            <table class="table table-striped table-sm my-0 mydatatable">
                                <thead>
                                <tr>
                                    <th>Channel</th>
                                    <th>Contact</th>
                                    <th>Queue</th>
                                    <th>Date / Time</th>
                                    <th>Disposition</th>
                                    <th>Notes</th>

                                    <th>Recording</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="call in (selectedContact !== null && contacts[selectedContact].id) ? getMyContactLogs(contacts[selectedContact].id) : []">
                                    <td>{{call ? call.type : ''}}</td>
                                    <td>{{call ? call.fromNumber : ''}}</td>
                                    <td>{{call ? call.queue : ''}}</td>
                                    <td>{{call ? formatCallTimestamp(call.timestamp) : ''}}</td>
                                    <td>{{call ? call.dispositionCode : ''}}</td>
                                    <td>{{call ? call.notes : ''}}</td>
                                    <td><a v-if="call && call.type !='chat' && call.type !='sms' && call.engagementId && zccRecordingURLs[call.engagementId]"
                                           :href="zccRecordingURLs[call.engagementId]"
                                           target="_blank">download</a></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>

            <div id="debug" v-if="pageView=='debug'" class="container-fluid">
                <h3 class="text-dark mb-4">Debug Information</h3>
                <div class="card shadow">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Smart Embed Logs</p>
                        <button class="btn btn-sm btn-danger" @click.prevent="zccSmartEmbedLogs=[]">Clear</button>

                    </div>
                    <div class="card-body">
                        <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                            <table class="table table-striped table-sm my-0">
                                <thead>
                                <tr>
                                    <th>Direction</th>
                                    <th>Payload</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="log in zccSmartEmbedLogs">
                                    <td>{{log ? log.direction : ''}}</td>
                                    <td><pre>{{log && log.payload ? JSON.stringify(log.payload, null, 2) : ''}}</pre></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="card shadow mt-4">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Smart Embed Dimensions</p>
                    </div>
                    <div class="card-body">
                        <p><strong>Height:</strong> {{zccSmartEmbedDimensions.heightInPixels}} pixels</p>
                        <p><strong>Width:</strong> {{zccSmartEmbedDimensions.widthInPixels}} pixels</p>
                    </div>
                </div>
                <div class="card shadow mt-4">
                    <div class="card-header py-3 d-flex justify-content-between align-items-center">
                        <p class="text-primary m-0 fw-bold">Engagement Cache</p>
                        <div>
                            <button class="btn btn-sm btn-primary me-2" @click.prevent="refreshEngagementData()" :disabled="isRefreshing">
                                <span v-if="isRefreshing" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                                {{ isRefreshing ? 'Refreshing...' : 'Refresh' }}
                            </button>
                            <button class="btn btn-sm btn-danger" @click.prevent="zccEngagementCache={}">Clear</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                            <table class="table table-striped table-sm my-0">
                                <thead>
                                <tr>
                                    <th>Engagement ID</th>
                                    <th>Channel</th>
                                    <th>Direction</th>
                                    <th>State</th>
                                    <th>Customer</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="(engagement, id) in zccEngagementCache" :key="id">
                                    <td>{{ id }}</td>
                                    <td>{{ engagement.channel }}</td>
                                    <td>{{ engagement.engagementDirection }}</td>
                                    <td>{{ engagement.state }}</td>
                                    <td>
                                        <span v-if="engagement.customerName">{{ engagement.customerName }}</span>
                                        <span v-else-if="engagement.customerEmail">{{ engagement.customerEmail }}</span>
                                        <span v-else-if="engagement.customerNumber">{{ engagement.customerNumber }}</span>
                                        <span v-else>N/A</span>
                                    </td>
                                    <td>
                                        <button v-if="engagement.state === 'active'" class="btn btn-sm btn-danger me-2" @click="terminateEngagement(id, engagement.channel)">Terminate</button>
                                        <template v-if="engagement.state === 'wrapup'">
                                            <button class="btn btn-sm btn-success me-2" @click="closeEngagementWrapup(id, engagement.channel)">Close</button>
                                            <input type="text" class="form-control form-control-sm d-inline-block w-auto" placeholder="Disposition ID" v-model="engagement.dispositionId" @change="setEngagementDisposition(id, engagement.channel, engagement.dispositionId)">
                                        </template>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>

            <div id="settings" v-if="pageView=='settings'" class="container-fluid">
                <h3 class="text-dark mb-4">Settings</h3>

                <!-- Tab Navigation -->
                <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" :class="{ active: activeSettingsTab === 'general' }"
                                @click="setActiveSettingsTab('general')" type="button" role="tab">
                            <i class="fas fa-cog me-2"></i>General
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" :class="{ active: activeSettingsTab === 'disposition' }"
                                @click="setActiveSettingsTab('disposition')" type="button" role="tab">
                            <i class="fas fa-tags me-2"></i>Disposition Mapping
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" :class="{ active: activeSettingsTab === 'status' }"
                                @click="setActiveSettingsTab('status')" type="button" role="tab">
                            <i class="fas fa-user-circle me-2"></i>Status Mapping
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" :class="{ active: activeSettingsTab === 'custom-card' }"
                                @click="setActiveSettingsTab('custom-card')" type="button" role="tab">
                            <i class="fas fa-id-card me-2"></i>Custom Card
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="settingsTabContent">
                    <!-- General Settings Tab -->
                    <div class="tab-pane fade" :class="{ 'show active': activeSettingsTab === 'general' }" role="tabpanel">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <p class="text-primary m-0 fw-bold">General</p>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="clusterSelect" class="form-label">Cluster</label>
                                    <select class="form-select" id="clusterSelect" v-model="cluster" @change="saveSettingsAndReload">
                                        <option value="default">Default</option>
                                        <option value="go">GO</option>
                                        <option value="gov">GOV</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="ctiVersionSelect" class="form-label">CTI Version</label>
                                    <select class="form-select" id="ctiVersionSelect" v-model="ctiVersion" @change="saveSettingsAndReload">
                                        <option value="1">1</option>
                                        <option value="3">3</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="placementSelect" class="form-label">Placement</label>
                                    <select class="form-select" id="placementSelect" v-model="placement" @change="saveSettingsAndReload">
                                        <option value="right-side">Right side</option>
                                        <option value="hover">Hover</option>
                                    </select>
                                </div>
                                <hr>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="debugToggle" v-model="debug" @change="saveSettings">
                                    <label class="form-check-label" for="debugToggle">Show Smart Embed debug postMessage Events</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="showAgentStatusToggle" v-model="showAgentStatus" @change="saveSettings" :disabled="isShowAgentStatusDisabled">
                                    <label class="form-check-label" for="showAgentStatusToggle" :class="{'text-muted': isShowAgentStatusDisabled}">
                                        Show agent status in web app
                                        <small v-if="isShowAgentStatusDisabled" class="text-muted d-block">(Automatically enabled when placement is hover)</small>
                                    </label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="allowUserToChangeStatusToggle" v-model="allowUserToChangeStatus" @change="saveSettings" :disabled="isAllowUserToChangeStatusDisabled">
                                    <label class="form-check-label" for="allowUserToChangeStatusToggle" :class="{'text-muted': isAllowUserToChangeStatusDisabled}">
                                        Allow user to change status in web app
                                        <small v-if="isAllowUserToChangeStatusDisabled" class="text-muted d-block">(Requires 'Show agent status' to be enabled)</small>
                                    </label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="showEngagementCountToggle" v-model="showEngagementCount" @change="saveSettings">
                                    <label class="form-check-label" for="showEngagementCountToggle">Show engagement count in web app</label>
                                </div>

                                <div class="mb-3">
                                    <label for="vanitySubdomainInput" class="form-label">Vanity Subdomain for improved SSO support</label>
                                    <input type="text" class="form-control" id="vanitySubdomainInput" v-model="vanitySubdomain" @change="saveSettingsAndReload">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Disposition Code Mapping Tab -->
                    <div class="tab-pane fade" :class="{ 'show active': activeSettingsTab === 'disposition' }" role="tabpanel">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <p class="text-primary m-0 fw-bold">Disposition Code Mapping</p>
                                <span>In this section, you can configure your Zoom account disposition 'id' to disposition 'name' mappings. This will be used to allow you to set the disposition from a field in the CRM.</span>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>Add New Mapping</h5>
                                        <form @submit.prevent="addDispositionMapping">
                                            <div class="mb-3">
                                                <label for="dispositionId" class="form-label">Disposition ID</label>
                                                <input type="text" class="form-control" id="dispositionId" v-model="newDisposition.id" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="dispositionName" class="form-label">Disposition Name</label>
                                                <input type="text" class="form-control" id="dispositionName" v-model="newDisposition.name" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Add Mapping</button>
                                        </form>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Existing Mappings</h5>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(mapping, index) in dispositionMappings">
                                                    <td>{{ mapping.id }}</td>
                                                    <td>{{ mapping.name }}</td>
                                                    <td><button class="btn btn-danger btn-sm" @click="deleteDispositionMapping(index)">Delete</button></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <span>The ability for the parent web app to update the disposition requires that the web developer retrieves the dispositionIds via OpenAPI.  That is not possible with this demo web app, so you will need to supply the dispositionId from your account if you wish to test this feature. Please note that the disposition must be assigned to the queue for the engaegement for this feature to work.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Code Mapping Tab -->
                    <div class="tab-pane fade" :class="{ 'show active': activeSettingsTab === 'status' }" role="tabpanel">
                        <div class="card shadow">
                            <div class="card-header py-3">
                                <p class="text-primary m-0 fw-bold">Status Code Mapping</p>
                                <span>In this section, you can configure custom "Not Ready" reasons. This settting maps the agent status 'id' to the custom status 'name'. These will appear in the agent status dropdown.  This section will automatically update with any Not Ready reason codes that are seen by this web app.</span>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>Add New Custom 'Not Ready' Status</h5>
                                        <form @submit.prevent="addStatusMapping">
                                            <div class="mb-3">
                                                <label for="statusId" class="form-label">Status ID</label>
                                                <input type="text" class="form-control" id="statusId" v-model="newStatus.id" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="statusName" class="form-label">Status Name</label>
                                                <input type="text" class="form-control" id="statusName" v-model="newStatus.name" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Add Status</button>
                                        </form>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Existing Custom 'Not Ready' Statuses</h5>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(mapping, index) in statusMappings">
                                                    <td>{{ mapping.id }}</td>
                                                    <td>{{ mapping.name }}</td>
                                                    <td><button class="btn btn-danger btn-sm" @click="deleteStatusMapping(index)">Delete</button></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <h6>System Statuses (Cannot be changed)</h6>
                                    <ul>
                                        <li v-for="status in systemStatuses"><b>{{ status.id }}</b>: {{ status.name }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Card Configuration Tab -->
                    <div class="tab-pane fade" :class="{ 'show active': activeSettingsTab === 'custom-card' }" role="tabpanel">
                        <div class="card shadow mt-4">
                            <div class="card-header py-3">
                                <p class="text-primary m-0 fw-bold">Custom Card Configuration</p>
                                <span>In this section, you can configure a card to appear on the Contact Details page.  This card can display ZCC custom variable data that is passed from Smart Embed into the CRM.</span>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="customCardTitle" class="form-label">Card Title</label>
                                    <input type="text" class="form-control" id="customCardTitle" v-model="customCard.title" @change="saveCustomCardConfig">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Display Logic</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="alwaysDisplay" value="always" v-model="customCard.displayRule" @change="saveCustomCardConfig">
                                        <label class="form-check-label" for="alwaysDisplay">Always display card</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="ifVariablePopulated" value="if-variable-populated" v-model="customCard.displayRule" @change="saveCustomCardConfig">
                                        <label class="form-check-label" for="ifVariablePopulated">Only display card if at least one variable field is populated</label>
                                    </div>
                                </div>
                                <hr>
                                <h5>Add New Field</h5>
                                <form @submit.prevent="addCustomField">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="newFieldName" class="form-label">Display Name</label>
                                            <input type="text" class="form-control" id="newFieldName" v-model="newCustomField.displayName" required>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="newFieldType" class="form-label">Value Type</label>
                                            <select class="form-select" id="newFieldType" v-model="newCustomField.type">
                                                <option value="variable">Variable</option>
                                                <option value="hardcoded">Hardcoded</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3" v-if="newCustomField.type === 'variable'">
                                            <label for="newFieldSource" class="form-label">Variable Name</label>
                                            <input type="text" class="form-control" id="newFieldSource" v-model="newCustomField.source" required>
                                        </div>
                                        <div class="col-md-4 mb-3" v-if="newCustomField.type === 'hardcoded'">
                                            <label for="newFieldValue" class="form-label">Hardcoded Value</label>
                                            <input type="text" class="form-control" id="newFieldValue" v-model="newCustomField.value" required>
                                        </div>
                                        <div class="col-md-1 mb-3 d-flex align-items-end">
                                            <button type="submit" class="btn btn-primary">Add</button>
                                        </div>
                                    </div>
                                </form>
                                <hr>
                                <h5>Existing Fields</h5>
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm">
                                        <thead>
                                        <tr>
                                            <th>Display Name</th>
                                            <th>Type</th>
                                            <th>Source/Value</th>
                                            <th>Actions</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr v-for="(field, index) in customCard.fields">
                                            <td>{{ field.displayName }}</td>
                                            <td>{{ field.type }}</td>
                                            <td>{{ field.type === 'variable' ? field.source : field.value }}</td>
                                            <td><button class="btn btn-danger btn-sm" @click="deleteCustomField(index)">Delete</button></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="row">
                                    <span>The purpose of this card is to display global variable data passed by Smart Embed. For this card to display, the caller's phone number must exist on a Contact.  When an inbound call is received from that number, we will screen pop the contact and display this card if the display logic criteria is met.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div v-if="placement === 'hover'" id="floating-iframe-container" :class="{'floating-hidden': !isIframeFloatingVisible}" :style="iframeStyle">
        <div id="floating-iframe-header" style="display: flex; justify-content: space-between; align-items: center;">
            <span @mousedown="startDrag" class="title" style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Smart Embed</span>
            <i class="bi bi-x close-btn" @click.prevent="toggleFloatingIframeVisibility"></i>
        </div>
        <iframe
                v-bind:src="smartEmbedUrl"
                sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-scripts allow-same-origin allow-downloads"
                allow="geolocation;autoplay;microphone;camera;display-capture;midi;encrypted-media;clipboard-write;"
                id="zoom-embeddable-phone-iframe-hover">
        </iframe>
    </div>
    <div id="iframe-resize-handle" v-if="placement === 'right-side'">
        <i :class="collapseIconClass" @click.stop="toggleIframeCollapse" style="cursor: pointer; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; z-index: 11;"></i>
    </div>
    <iframe v-if="placement === 'right-side'"
            v-bind:style="'width: ' + zccSmartEmbedDimensions.widthInPixels + 'px; height: 100vh;'"
            v-bind:src="smartEmbedUrl"
            sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-scripts allow-same-origin allow-downloads"
            allow="geolocation;autoplay;microphone;camera;display-capture;midi;encrypted-media;clipboard-write;"
            id="zoom-embeddable-phone-iframe-right-side">
    </iframe>
</div>
</div>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="/js/main.js"></script>
<!-- Cloudflare Pages Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "6b534b2c3f3348bfbbf902133bf8d408"}'></script><!-- Cloudflare Pages Analytics --></body>
</html>


